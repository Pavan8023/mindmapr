<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>MindMapr | Sign in</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: radial-gradient(circle at top left, #4f46e5, #020617);
      min-height: 100vh;
    }

    .float-blob {
      animation: float 8s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-20px);
      }
    }

    .fade-up {
      animation: fadeUp 0.9s ease-out forwards;
      opacity: 0;
      transform: translateY(16px);
    }

    @keyframes fadeUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      margin: -10px 0 0 -10px;
      border: 2px solid #ffffff;
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body class="text-white flex items-center justify-center">
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="float-blob w-72 h-72 bg-purple-500/20 rounded-full blur-3xl absolute -top-10 -left-10"></div>
    <div class="float-blob w-80 h-80 bg-indigo-500/20 rounded-full blur-3xl absolute bottom-0 right-0"
      style="animation-delay:1.5s;"></div>
  </div>

  <div class="w-full flex items-center justify-center fade-up relative z-10 px-6 lg:px-16">
    <div class="w-full grid lg:grid-cols-2 gap-10 items-center">
      <div class="space-y-6">
        <div
          class="inline-flex items-center gap-2 rounded-full bg-white/10 px-4 py-1 text-xs uppercase tracking-[0.2em]">
          <span class="h-2 w-2 rounded-full bg-emerald-400"></span>
          Live Knowledge Mapping
        </div>
        <h1 class="text-4xl md:text-5xl font-bold leading-tight">
          Turn questions into
          <span class="text-emerald-400">visual mind maps</span>
        </h1>
        <p class="text-sm md:text-base text-slate-200/80">
          MindMapr lets you ask questions, share answers, and see discussions as interactive mind maps across the whole
          screen.
        </p>
        <div class="flex items-center gap-4 text-xs text-slate-200/70">
          <div class="flex -space-x-2">
            <div class="w-8 h-8 rounded-full bg-emerald-400/80 border-2 border-slate-900"></div>
            <div class="w-8 h-8 rounded-full bg-indigo-400/80 border-2 border-slate-900"></div>
            <div
              class="w-8 h-8 rounded-full bg-pink-400/80 border-2 border-slate-900 flex items-center justify-center text-[10px] font-semibold">
              1K+
            </div>
          </div>
          <span>Learners mapping their questions in real time</span>
        </div>
      </div>

      <div
        class="bg-slate-900/80 backdrop-blur-xl rounded-3xl shadow-2xl shadow-indigo-900/40 p-6 md:p-8 border border-white/10 w-full max-w-md mx-auto">
        <!-- Current User Info (if logged in) -->
        <div id="current-user-info" class="mb-4 p-3 bg-slate-800/50 rounded-lg hidden">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <img id="current-user-avatar" class="w-6 h-6 rounded-full" src="" alt="">
              <span id="current-user-name" class="text-sm text-slate-300"></span>
            </div>
            <button id="use-different-account" class="text-xs text-indigo-400 hover:text-indigo-300 underline">
              Use different account
            </button>
          </div>
        </div>

        <div class="flex mb-6 rounded-full bg-slate-800/80 p-1">
          <button id="tab-login"
            class="flex-1 text-center text-xs md:text-sm py-2 rounded-full bg-indigo-500 text-white font-medium transition">
            Login
          </button>
          <button id="tab-signup"
            class="flex-1 text-center text-xs md:text-sm py-2 rounded-full text-slate-200 font-medium transition">
            Sign up
          </button>
        </div>

        <form id="login-form" class="space-y-4">
          <div class="space-y-1">
            <label class="text-xs font-medium text-slate-200">Email</label>
            <input id="login-email" type="email"
              class="w-full rounded-2xl bg-slate-900/80 border border-slate-700 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              autocomplete="email" required>
          </div>
          <div class="space-y-1">
            <label class="text-xs font-medium text-slate-200">Password</label>
            <input id="login-password" type="password"
              class="w-full rounded-2xl bg-slate-900/80 border border-slate-700 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              autocomplete="current-password" required>
          </div>
          <button type="submit" id="login-submit"
            class="w-full mt-2 rounded-2xl bg-indigo-500 hover:bg-indigo-400 active:scale-[0.98] transition transform py-2.5 text-sm font-semibold flex items-center justify-center gap-2 relative">
            <span>Continue to MindMapr</span>
            <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-indigo-600 text-[10px]">→</span>
          </button>

          <div class="flex items-center gap-3 my-3">
            <div class="h-px flex-1 bg-slate-700"></div>
            <span class="text-[10px] text-slate-400">or</span>
            <div class="h-px flex-1 bg-slate-700"></div>
          </div>

          <button type="button" id="google-login"
            class="w-full rounded-2xl bg-white text-slate-900 hover:bg-slate-100 active:scale-[0.98] transition transform py-2.5 text-sm font-semibold flex items-center justify-center gap-2 relative">
            <svg class="w-4 h-4" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Continue with Google</span>
          </button>

          <p class="text-[11px] text-slate-300/80 text-center mt-2">
            New here?
            <button type="button" id="switch-to-signup" class="text-emerald-400 hover:underline">
              Create an account
            </button>
          </p>
        </form>

        <form id="signup-form" class="space-y-4 hidden">
          <div class="space-y-1">
            <label class="text-xs font-medium text-slate-200">Full name</label>
            <input id="signup-name" type="text"
              class="w-full rounded-2xl bg-slate-900/80 border border-slate-700 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              autocomplete="name" required>
          </div>
          <div class="space-y-1">
            <label class="text-xs font-medium text-slate-200">Email</label>
            <input id="signup-email" type="email"
              class="w-full rounded-2xl bg-slate-900/80 border border-slate-700 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              autocomplete="email" required>
          </div>
          <div class="space-y-1">
            <label class="text-xs font-medium text-slate-200">Password</label>
            <input id="signup-password" type="password"
              class="w-full rounded-2xl bg-slate-900/80 border border-slate-700 px-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500"
              autocomplete="new-password" required minlength="6">
          </div>
          <button type="submit" id="signup-submit"
            class="w-full mt-2 rounded-2xl bg-emerald-500 hover:bg-emerald-400 active:scale-[0.98] transition transform py-2.5 text-sm font-semibold flex items-center justify-center gap-2 relative">
            <span>Create account</span>
            <span class="inline-flex h-5 w-5 items-center justify-center rounded-full bg-emerald-600 text-[10px]">★</span>
          </button>

          <div class="flex items-center gap-3 my-3">
            <div class="h-px flex-1 bg-slate-700"></div>
            <span class="text-[10px] text-slate-400">or</span>
            <div class="h-px flex-1 bg-slate-700"></div>
          </div>

          <button type="button" id="google-signup"
            class="w-full rounded-2xl bg-white text-slate-900 hover:bg-slate-100 active:scale-[0.98] transition transform py-2.5 text-sm font-semibold flex items-center justify-center gap-2 relative">
            <svg class="w-4 h-4" viewBox="0 0 24 24">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span>Continue with Google</span>
          </button>

          <p class="text-[11px] text-slate-300/80 text-center mt-2">
            Already have an account?
            <button type="button" id="switch-to-login" class="text-indigo-400 hover:underline">
              Log in
            </button>
          </p>
        </form>

        <p id="auth-message" class="mt-3 text-xs text-center text-rose-300/90 min-h-[1.25rem]"></p>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyB24FGLvbQTDNmAH_YO60V_r4ynEhpxIJs",
      authDomain: "mindmapr-638c1.firebaseapp.com",
      projectId: "mindmapr-638c1",
      storageBucket: "mindmapr-638c1.firebasestorage.app",
      messagingSenderId: "886840058208",
      appId: "1:886840058208:web:330a3433d1ab036c663e05",
      measurementId: "G-F9R3TQ3262"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Set session persistence to allow multiple users in different tabs/windows
    auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
      .then(() => {
        console.log("Session persistence enabled");
      })
      .catch((error) => {
        console.error("Error setting persistence:", error);
      });

    // DOM Elements
    const tabLogin = document.getElementById("tab-login");
    const tabSignup = document.getElementById("tab-signup");
    const loginForm = document.getElementById("login-form");
    const signupForm = document.getElementById("signup-form");
    const switchToSignup = document.getElementById("switch-to-signup");
    const switchToLogin = document.getElementById("switch-to-login");
    const authMessage = document.getElementById("auth-message");
    const googleLoginBtn = document.getElementById("google-login");
    const googleSignupBtn = document.getElementById("google-signup");
    const currentUserInfo = document.getElementById("current-user-info");
    const currentUserAvatar = document.getElementById("current-user-avatar");
    const currentUserName = document.getElementById("current-user-name");
    const useDifferentAccount = document.getElementById("use-different-account");

    // Tab Switching
    function showLogin() {
      tabLogin.classList.add("bg-indigo-500", "text-white");
      tabLogin.classList.remove("text-slate-200");
      tabSignup.classList.remove("bg-indigo-500", "text-white");
      tabSignup.classList.add("text-slate-200");
      loginForm.classList.remove("hidden");
      signupForm.classList.add("hidden");
      authMessage.textContent = "";
    }

    function showSignup() {
      tabSignup.classList.add("bg-indigo-500", "text-white");
      tabSignup.classList.remove("text-slate-200");
      tabLogin.classList.remove("bg-indigo-500", "text-white");
      tabLogin.classList.add("text-slate-200");
      signupForm.classList.remove("hidden");
      loginForm.classList.add("hidden");
      authMessage.textContent = "";
    }

    tabLogin.addEventListener("click", showLogin);
    tabSignup.addEventListener("click", showSignup);
    switchToSignup.addEventListener("click", showSignup);
    switchToLogin.addEventListener("click", showLogin);

    // Show current user info if already logged in
    function showCurrentUserInfo(user) {
      if (user) {
        currentUserAvatar.src = user.photoURL || 'https://via.placeholder.com/24?text=U';
        currentUserName.textContent = user.displayName || user.email;
        currentUserInfo.classList.remove('hidden');
      } else {
        currentUserInfo.classList.add('hidden');
      }
    }

    // Use different account
    useDifferentAccount.addEventListener('click', () => {
      auth.signOut().then(() => {
        currentUserInfo.classList.add('hidden');
        showLogin();
      });
    });

    // Create User Document in Firestore (users collection)
    async function createUserDocument(user, additionalData = {}) {
      try {
        const userRef = db.collection('users').doc(user.uid);
        const userDoc = await userRef.get();
        
        if (!userDoc.exists) {
          await userRef.set({
            uid: user.uid,
            email: user.email,
            displayName: additionalData.name || user.displayName || user.email.split('@')[0],
            photoURL: user.photoURL || '',
            authProvider: additionalData.authProvider || 'email',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            lastLoginAt: firebase.firestore.FieldValue.serverTimestamp(),
            hasPassword: additionalData.authProvider === 'google' ? false : true
          });
          console.log('User document created successfully in users collection');
        } else {
          // Update last login time for existing user
          await userRef.update({
            lastLoginAt: firebase.firestore.FieldValue.serverTimestamp(),
            displayName: user.displayName || userDoc.data().displayName,
            photoURL: user.photoURL || userDoc.data().photoURL
          });
        }
      } catch (error) {
        console.error('Error creating user document:', error);
        throw error;
      }
    }

    // Email/Password Login
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value.trim();
      const submitBtn = document.getElementById("login-submit");
      
      authMessage.textContent = "";
      submitBtn.classList.add("loading");
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        await createUserDocument(userCredential.user, { authProvider: 'email' });
        window.location.href = "dashboard.html";
      } catch (error) {
        authMessage.textContent = getAuthErrorMessage(error);
      } finally {
        submitBtn.classList.remove("loading");
      }
    });

    // Email/Password Signup
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("signup-name").value.trim();
      const email = document.getElementById("signup-email").value.trim();
      const password = document.getElementById("signup-password").value.trim();
      const submitBtn = document.getElementById("signup-submit");
      
      authMessage.textContent = "";
      submitBtn.classList.add("loading");
      
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        // Update profile with name
        await userCredential.user.updateProfile({
          displayName: name
        });
        await createUserDocument(userCredential.user, { 
          name: name,
          authProvider: 'email' 
        });
        window.location.href = "dashboard.html";
      } catch (error) {
        authMessage.textContent = getAuthErrorMessage(error);
      } finally {
        submitBtn.classList.remove("loading");
      }
    });

    // Google Sign In
    async function handleGoogleSignIn() {
      authMessage.textContent = "";
      
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('profile');
        provider.addScope('email');
        
        const result = await auth.signInWithPopup(provider);
        await createUserDocument(result.user, { 
          authProvider: 'google' 
        });
        window.location.href = "dashboard.html";
      } catch (error) {
        authMessage.textContent = getAuthErrorMessage(error);
      }
    }

    googleLoginBtn.addEventListener("click", handleGoogleSignIn);
    googleSignupBtn.addEventListener("click", handleGoogleSignIn);

    // Error Message Helper
    function getAuthErrorMessage(error) {
      switch (error.code) {
        case 'auth/invalid-email':
          return 'Invalid email address.';
        case 'auth/user-disabled':
          return 'This account has been disabled.';
        case 'auth/user-not-found':
          return 'No account found with this email.';
        case 'auth/wrong-password':
          return 'Incorrect password.';
        case 'auth/email-already-in-use':
          return 'An account with this email already exists.';
        case 'auth/weak-password':
          return 'Password should be at least 6 characters.';
        case 'auth/popup-closed-by-user':
          return 'Google sign-in was cancelled.';
        case 'auth/network-request-failed':
          return 'Network error. Please check your connection.';
        default:
          return error.message || 'An error occurred. Please try again.';
      }
    }

    // Check if user is already logged in (but don't redirect)
    auth.onAuthStateChanged((user) => {
      if (user) {
        // Show current user info but don't redirect automatically
        showCurrentUserInfo(user);
        console.log("User is logged in:", user.email);
        console.log("You can log in with a different account if needed");
      } else {
        currentUserInfo.classList.add('hidden');
      }
    });
  </script>
</body>
</html>